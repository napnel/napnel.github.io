---
import { getCollection } from 'astro:content';
import BaseHead from '../../components/BaseHead.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import { SITE_TITLE, SITE_DESCRIPTION } from '../../consts';

const posts = await getCollection('blog');

// Collect all tags and count posts per tag
const tagCounts = new Map<string, number>();
posts.forEach((post) => {
	const tags = post.data.tags || [];
	tags.forEach((tag) => {
		tagCounts.set(tag, (tagCounts.get(tag) || 0) + 1);
	});
});

// Sort tags alphabetically
const sortedTags = Array.from(tagCounts.entries()).sort((a, b) =>
	a[0].localeCompare(b[0])
);
---

<!doctype html>
<html lang="en">
	<head>
		<BaseHead title={`Tags | ${SITE_TITLE}`} description={SITE_DESCRIPTION} />
	</head>
	<body>
		<Header />
		<main>
			<h1>Tags</h1>
			<p>Browse posts by topic</p>

			{sortedTags.length === 0 ? (
				<p>No tags found.</p>
			) : (
				<ul class="tag-list">
					{sortedTags.map(([tag, count]) => (
						<li>
							<a href={`/tags/${tag.toLowerCase()}`}>
								{tag}
								<span class="count">({count})</span>
							</a>
						</li>
					))}
				</ul>
			)}
		</main>
		<Footer />
	</body>
</html>

<style>
	main {
		width: 960px;
		max-width: calc(100% - 2em);
		margin: auto;
		padding: 3em 1em;
	}
	h1 {
		font-size: 2.5em;
		margin: 0.5em 0;
	}
	.tag-list {
		list-style: none;
		padding: 0;
		display: flex;
		flex-wrap: wrap;
		gap: 1rem;
		margin: 2rem 0;
	}
	.tag-list li {
		margin: 0;
	}
	.tag-list a {
		display: inline-block;
		padding: 0.5rem 1rem;
		background: #f3f3f3;
		border-radius: 0.5rem;
		text-decoration: none;
		color: #333;
		transition: background 0.2s;
	}
	.tag-list a:hover {
		background: #e0e0e0;
	}
	.count {
		color: #666;
		font-size: 0.9em;
	}
</style>
